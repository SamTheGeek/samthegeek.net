---
// Lightbox component for full-size image viewing
---

<div id="lightbox" class="lightbox">
  <div class="lightbox-controls" role="group" aria-label="Lightbox controls">
    <div class="lightbox-controls-row">
      <button class="lightbox-info-toggle" type="button" aria-label="Show photo info" aria-pressed="false">i</button>
      <span class="lightbox-divider" aria-hidden="true">|</span>
      <button class="lightbox-close" type="button" aria-label="Close lightbox">x</button>
    </div>
    <div class="lightbox-info" aria-live="polite">
      <div class="lightbox-title" id="lightbox-title"></div>
      <div class="lightbox-meta" id="lightbox-meta"></div>
    </div>
  </div>
  <div class="lightbox-content">
    <img id="lightbox-image" src="" alt="" />
  </div>
  <div class="lightbox-info" aria-live="polite">
    <div class="lightbox-title" id="lightbox-title"></div>
    <div class="lightbox-meta" id="lightbox-meta"></div>
  </div>
</div>

<style>
  .lightbox {
    display: none;
    position: fixed;
    z-index: 9999;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.75);
    justify-content: center;
    align-items: center;
  }

  .lightbox.active {
    display: flex;
  }

  .lightbox-content {
    max-width: 90%;
    max-height: 90%;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    margin: 0 auto;
  }

  .lightbox-content img {
    max-width: 100%;
    max-height: 90vh;
    object-fit: contain;
    box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
    margin: 0 auto;
  }

  .lightbox-controls {
    position: absolute;
    top: 18px;
    right: 24px;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 0.35rem;
    padding-top: var(--pill-height);
    width: var(--pill-width);
    isolation: isolate;
    box-sizing: border-box;
    z-index: 10000;
    --pill-width: 4.6rem;
    --pill-height: 2.1rem;
    --pill-radius: calc(var(--pill-height) / 2);
    transition: width 0.35s cubic-bezier(0.22, 1, 0.36, 1),
      padding 0.35s cubic-bezier(0.22, 1, 0.36, 1);
  }

  .lightbox-controls::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: var(--pill-width);
    height: var(--pill-height);
    border-radius: var(--pill-radius);
    background: rgba(18, 18, 18, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(6px);
    z-index: -1;
    transition: width 0.35s cubic-bezier(0.22, 1, 0.36, 1),
      height 0.35s cubic-bezier(0.22, 1, 0.36, 1);
  }

  .lightbox-controls-row {
    position: absolute;
    top: 0;
    right: 0;
    display: flex;
    align-items: center;
    gap: 0.35rem;
    min-height: var(--pill-height);
    width: var(--pill-width);
    justify-content: center;
  }

  .lightbox-info {
    display: block;
    width: 100%;
    max-width: min(70vw, 360px);
    min-width: 220px;
    color: #f5f5f5;
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    pointer-events: none;
    transform: translateX(18px) translateY(-6px);
    transition: opacity 0.35s cubic-bezier(0.22, 1, 0.36, 1),
      max-height 0.35s cubic-bezier(0.22, 1, 0.36, 1),
      transform 0.35s cubic-bezier(0.22, 1, 0.36, 1);
  }

  .lightbox-info.active {
    opacity: 1;
    max-height: 200px;
    pointer-events: auto;
    transform: translateX(0) translateY(0);
  }

  .lightbox-title,
  .lightbox-meta {
    font-size: 0.95rem;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.78);
    letter-spacing: 0.01em;
  }

  .lightbox-controls button {
    background: transparent;
    border: none;
    color: #f1f1f1;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    width: 1.6rem;
    height: 1.6rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
    transition: opacity 0.2s ease;
  }

  .lightbox-controls button:hover {
    opacity: 0.7;
  }

  .lightbox-info-toggle.active {
    background: rgba(255, 255, 255, 0.18);
    border-radius: 999px;
  }

  .lightbox-info-toggle {
    font-size: 0.85rem;
  }

  .lightbox-controls.expanded {
    padding: calc(var(--pill-height) + 0.5rem) 0.7rem 0.65rem;
    width: min(70vw, 360px);
  }

  .lightbox-controls.expanded::before {
    width: 100%;
    height: 100%;
  }

  .lightbox-divider {
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.9rem;
  }

  @media (max-width: 768px) {
    .lightbox-controls {
      top: 10px;
      right: 10px;
    }

    .lightbox-controls.expanded {
      width: calc(100vw - 32px);
    }

    .lightbox-info {
      max-width: 100%;
      min-width: 0;
    }

    .lightbox-content {
      max-width: 95%;
      max-height: 95%;
    }
  }
</style>

<script>
  // Lightbox functionality
  function initLightbox() {
    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightbox-image') as HTMLImageElement;
    const lightboxTitle = document.getElementById('lightbox-title');
    const lightboxMeta = document.getElementById('lightbox-meta');
    const closeBtn = document.querySelector('.lightbox-close');
    const infoToggle = document.querySelector('.lightbox-info-toggle') as HTMLButtonElement | null;
    const infoBox = document.querySelector('.lightbox-info');
    const controls = document.querySelector('.lightbox-controls');

    // Get all gallery images
    const galleryImages = Array.from(document.querySelectorAll('.gallery-item img'));

    // Add click event to each gallery image
    galleryImages.forEach((img) => {
      img.addEventListener('click', () => {
        openLightbox(img as HTMLImageElement);
      });
    });

    // Close lightbox
    closeBtn?.addEventListener('click', closeLightbox);
    lightbox?.addEventListener('click', (e) => {
      if (e.target === lightbox) {
        closeLightbox();
      }
    });

    // Info toggle
    infoToggle?.addEventListener('click', () => {
      if (!infoBox) return;
      const isOpen = infoBox?.classList.toggle('active') ?? false;
      controls?.classList.toggle('expanded', isOpen);
      infoToggle.classList.toggle('active', isOpen);
      infoToggle.setAttribute('aria-pressed', String(isOpen));
      infoToggle.setAttribute('aria-label', isOpen ? 'Hide photo info' : 'Show photo info');
    });

    // Keyboard navigation - ESC only
    document.addEventListener('keydown', (e) => {
      if (!lightbox?.classList.contains('active')) return;
      if (e.key === 'Escape') closeLightbox();
    });

    function openLightbox(img: HTMLImageElement) {
      if (!lightbox || !lightboxImage) return;

      lightboxImage.src = img.src;
      lightboxImage.alt = img.alt;
      if (lightboxTitle) {
        lightboxTitle.textContent = img.alt || 'Photo';
      }
      if (lightboxMeta) {
        const path = new URL(img.src).pathname;
        const filename = decodeURIComponent(path.split('/').pop() || '');
        lightboxMeta.textContent = filename;
      }
      lightbox.classList.add('active');
      document.body.style.overflow = 'hidden';
      infoBox?.classList.remove('active');
      controls?.classList.remove('expanded');
      if (infoToggle) {
        infoToggle.classList.remove('active');
        infoToggle.setAttribute('aria-pressed', 'false');
        infoToggle.setAttribute('aria-label', 'Show photo info');
      }
    }

    function closeLightbox() {
      if (!lightbox) return;

      lightbox.classList.remove('active');
      document.body.style.overflow = '';
      if (lightboxTitle) lightboxTitle.textContent = '';
      if (lightboxMeta) lightboxMeta.textContent = '';
      infoBox?.classList.remove('active');
      controls?.classList.remove('expanded');
      if (infoToggle) {
        infoToggle.classList.remove('active');
        infoToggle.setAttribute('aria-pressed', 'false');
        infoToggle.setAttribute('aria-label', 'Show photo info');
      }
    }
  }

  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLightbox);
  } else {
    initLightbox();
  }

  // Reinitialize after navigation (for Astro's View Transitions if used)
  document.addEventListener('astro:page-load', initLightbox);
</script>
